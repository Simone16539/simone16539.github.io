<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grafico CSV</title>
</head>
<body>
    <input type="file" id="inputFileCSV" accept=".csv">
    <canvas id="graficoMio" width="1870" height="800"></canvas>
    <script>
        function analizzaCSV(dati) {
            const righe = dati.trim().split('\n');
            return righe.map(riga => riga.split(',').map(Number));
        }

        function disegnaGrafico(dati) {
            const canvas = document.getElementById('graficoMio');
            const ctx = canvas.getContext('2d');
            const anni = dati.map(riga => riga[0]);
            const migranti = dati.map(riga => riga[1]);

            const valoreMassimo = Math.ceil(Math.max(...migranti) / 20000) * 20000;
            const larghezzaSegmento = (canvas.width - 100) / (migranti.length - 1);

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Disegna gli assi
            ctx.beginPath();
            ctx.moveTo(50, canvas.height - 30);
            ctx.lineTo(canvas.width, canvas.height - 30);
            ctx.stroke();

            ctx.beginPath();
            ctx.moveTo(50, 0);
            ctx.lineTo(50, canvas.height - 30);
            ctx.stroke();

            // Etichette X (Anni)
            ctx.fillStyle = 'black';
            ctx.textAlign = 'center';
            anni.forEach((anno, indice) => {
                ctx.fillText(anno, 50 + indice * larghezzaSegmento, canvas.height - 10);
            });

            // Etichette Y (Numero di immigrati)
            ctx.textAlign = 'right';
            ctx.textBaseline = 'middle';
            for (let i = 0; i <= valoreMassimo; i += 20000) {
                const y = canvas.height - 30 - (i / valoreMassimo) * (canvas.height - 50);
                ctx.fillText(i, 45, y);
                ctx.beginPath();
                ctx.moveTo(50, y);
                ctx.lineTo(canvas.width, y);
                ctx.strokeStyle = '#e0e0e0';
                ctx.stroke();
            }

            // Disegna la linea continua
            ctx.beginPath();
            ctx.strokeStyle = 'blue';
            ctx.lineWidth = 2;

            for (let i = 0; i < migranti.length; i++) {
                const x = 50 + i * larghezzaSegmento;
                const y = canvas.height - 30 - (migranti[i] / valoreMassimo) * (canvas.height - 50);

                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            ctx.stroke();

            // Disegna i punti della linea
            ctx.fillStyle = 'red';
            migranti.forEach((valore, indice) => {
                const x = 50 + indice * larghezzaSegmento;
                const y = canvas.height - 30 - (valore / valoreMassimo) * (canvas.height - 50);
                ctx.beginPath();
                ctx.arc(x, y, 4, 0, Math.PI * 2);
                ctx.fill();
            });
        }

        document.getElementById('inputFileCSV').addEventListener('change', function(evento) {
            const file = evento.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const dati = analizzaCSV(e.target.result);
                    disegnaGrafico(dati);
                };
                reader.readAsText(file);
            }
        });
    </script>
</body>
</html>
