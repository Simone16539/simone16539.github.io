<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script>
        function apri(input) {
            let file = input.files[0];
            let reader = new FileReader();

            reader.readAsText(file);
            reader.onload = function () {
                const content = reader.result.trim();
                const rows = content.split("\n").map(row => row.split(",").map(cell => cell.trim()));
                
                if (rows.length < 2 || rows[0].length < 2) {
                    alert("Il file CSV deve contenere almeno due colonne.");
                    return;
                }
                
                let table = "<table border='1'>";
                rows.forEach((row, index) => {
                    table += "<tr>";
                    row.forEach(cell => {
                        table += index === 0 ? `<th>${cell}</th>` : `<td>${cell}</td>`;
                    });
                    table += "</tr>";
                });
                table += "</table>";
                document.getElementById("contenuto").innerHTML = table;

                generaGrafico(rows);
            };

            reader.onerror = function () {
                console.error("Errore nella lettura del file:", reader.error);
            };
        }

        function generaGrafico(rows) {
            const labels = rows.slice(1).map(row => row[0]);
            const values = rows.slice(1).map(row => parseFloat(row[1]) || 0);
            
            const canvas = document.getElementById('grafico');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            ctx.beginPath();
            ctx.strokeStyle = 'blue';
            ctx.lineWidth = 2;
            
            const maxVal = Math.max(...values);
            const minVal = Math.min(...values);
            const scaleX = canvas.width / (values.length - 1);
            const scaleY = canvas.height / (maxVal - minVal || 1);
            
            values.forEach((val, i) => {
                const x = i * scaleX;
                const y = canvas.height - (val - minVal) * scaleY;
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });
            
            ctx.stroke();
        }
    </script>
</head>
<body>
    <input type="file" id="myfile" name="seleziona file" onchange="apri(this)">
    <div id="contenuto"></div>
    <canvas id="grafico" width="400" height="200"></canvas>
</body>
</html>
